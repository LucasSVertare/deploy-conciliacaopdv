name: Deploy to GKE-teste

steps:
- name: 'gcr.io/cloud-builders/docker'
  id: 'Build Docker Image'
  args: ['build', '-t', 'gcr.io/cicd-conciliacaopdv/ubuntu:latest', '.']

- name: 'gcr.io/cloud-builders/docker'
    id: 'Push Docker Image to Repository'
    args: ['push', 'gcr.io/cicd-conciliacaopdv/ubuntu:latest']

- name: Configure kubectl
  run: |
    gcloud config set project cicd-conciliacaopdv
    gcloud config set compute/zone southamerica-east1-a
    gcloud container clusters get-credentials gke-pernambucanas-homologacao

- name: Apply deployment
  run: |
    kubectl apply -f deployment.yml